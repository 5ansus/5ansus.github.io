<!DOCTYPE html>
<!DOCTYPE html>

<html lang="es">
<html lang="en">

<head>

    <meta charset="UTF-8">

    <head>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="UTF-8">

        <title>Ranking de Programación Competitiva</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
        <meta name="google-site-verification" content="3zCKMvfqhUKy2ps6Smf5BbVG-vkemOTF34TRwLEejKU" />

        <style>
            <meta name="description" content="UAM CPrA Competitive Programming and Research Association at Universidad Autónoma de Madrid. Comunidad dedicada a la programación competitiva y la investigación STEM."><title>UAM-CPrA Homepage</title>body {
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">font-family: monospace;
                <link rel="stylesheet" href="src.css">background: linear-gradient(to bottom, #f0f4f8, #77ace9);
                </head>color: #333;

                margin: 0;
                <body>padding: 0;
                <header>background-repeat: no-repeat;
                <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top navbar-hidden">background-attachment: fixed;
                <div class="container-fluid">
            }

            <a class="navbar-brand" href="#">.logo {
                <img src="img/logo.png" alt="" width="30" height="30" class="d-inline-block align-text-top">UAM-CPrA max-width: 150px;
                </a>margin-bottom: 20px;
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"

            }

            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">.green {
                <span class="navbar-toggler-icon"></span>background-color: #d4edda;
                </button>color: #155724;
                <div class="collapse navbar-collapse" id="navbarNav">
            }

            <ul class="navbar-nav">.red {
                <li class="nav-item">background-color: #f8d7da;
                <a class="nav-link" href="#inicio">Home</a>color: #721c24;
                </li>
            }

            <li class="nav-item">.container {
                <a class="nav-link" href="#carousel">Highlights</a>padding: 20px;
                </li>
            }

            <li class="nav-item">.table {
                <a class="nav-link" href="#quienes-somos">About Us</a>background-color: #fff;
                </li>border-radius: 10px;
                <li class="nav-item">overflow: hidden;
                <a class="nav-link" href="#actividades">Activities</a>box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                </li>
            }

            <li class="nav-item">.thead-dark th {
                <a class="nav-link" href="#unete">Join Us</a>background-color: #343a40;
                </li>color: #fff;
                </ul>
            }

            </div>th,
            td {
                </div>text-align: center;
                </nav>vertical-align: middle;
                </header>
            }

            .update-info {
                <section id="inicio" class="d-flex align-items-center" style="background-color: #f2f2f2;">background-color: rgba(255, 255, 255, 0.9);
                <div class="container">border-radius: 10px;
                <br>padding: 15px;
                <br>margin-bottom: 20px;
                <div class="row">box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                <div class="col-lg-6 d-flex flex-column justify-content-center pt-4 pt-lg-0 order-2 order-lg-1"

            }

            data-aos="fade-up" data-aos-delay="200">.navbar-custom {
                <h1>UAM-CPrA</h1>background-color: rgba(255, 255, 255, 0.95);
                <h2>Autonomous University of Madrid Competitive Programming & research Association</h2>backdrop-filter: blur(10px);
                <blockquote>
            }

            <i>"Controlling complexity is the essence of computer programming"~Brian Kernighan</i>.loading {
                </blockquote>color: #007bff;
                </div>font-weight: bold;
                <div class="col-lg-6 order-1 order-lg-2" data-aos="zoom-in" data-aos-delay="200">
            }

            <img src="img/logo.png" class="img-fluid" alt="" style="max-width: 100%;">.header-controls {
                </div>margin-bottom: 20px;
                </div>
            }

            </div>.btn-custom {
                </section>margin: 0 5px;

            }

            <section id="carousel" class="carousel slide" data-bs-ride="carousel">
        </style>
        <div class="carousel-inner" id="carousel-inner"></div>

    </head> <button class="carousel-control-prev" type="button" data-bs-target="#carousel" data-bs-slide="prev">

<body> <span class="carousel-control-prev-icon" aria-hidden="true"></span>

    <!-- Navbar --> <span class="visually-hidden">Previous</span>

    <nav class="navbar navbar-expand-lg navbar-custom fixed-top"> </button>

        <div class="container"> <button class="carousel-control-next" type="button" data-bs-target="#carousel"
                data-bs-slide="next">

                <a class="navbar-brand" href="#"> <span class="carousel-control-next-icon" aria-hidden="true"></span>

                    <img src="img/logo.png" alt="Logo" height="30" class="d-inline-block align-text-top"> <span
                        class="visually-hidden">Next</span>

                    Ranking Competitivo </button>

            </a> </section>

            <div class="navbar-nav ml-auto">

                <a class="nav-link" href="problems.html">Ver Problemas</a>
                <section id="quienes-somos" class="bg-light">

                    <a class="nav-link" href="#" onclick="forceUpdate()">Actualizar</a>
                    <div class="container">

                    </div>
                    <div class="row">

                    </div>
                    <div class="col-md-6" style="padding: 20px;">

    </nav>
    <h2>Who are we?</h2>

    <p>

        <!-- Main Content --> CPrA at UAM builds on a principle that originated in a previous community, now inactive
        (<a <div class="container" style="margin-top: 80px;"> href="https://dotq-research.github.io/" style="color:
            grey;">dotQ</a>), co-founded by its

        <!-- Header --> founder: a principle centered on <em>

            <div class="text-center mb-4"> uniting intrepid and enthusiastic individuals passionate about STEM research
                and competitive

                <h1 id="contestName"
                    style="font-size: 2.5rem; font-weight: bold; color: #0056b3; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);">
                    programming.
        </em>

        Cargando concurso... This association was created to preserve the outstanding values that were found in that

        </h1> now-inactive community.
    </p>

    </div>
    <h5></h5>

    <p>

        <!-- Update Information --> Programming and research require (and need to promote) a principle of creativity and
        free

    <div class="update-info text-center"> thinking, regardless of its size, as long as it is beautiful

        <div class="row"> or functional.

            <div class="col-md-4"> <em>Here, you have to reinvent the wheel, and if you make it square, so what? Let's
                    adapt the

                    <strong>Última actualización:</strong><br> terrain then, and learn from it. But only on one
                    condition: create it yourself, because

                    <span id="lastUpdate" class="text-info">Cargando...</span> creating is the closest thing to
                    inventing. And then, create it again to improve it.</em>

            </div>
            </p>

            <div class="col-md-4">
                <h5></h5>

                <strong>Próxima actualización:</strong><br>
                <p>

                    <span id="nextUpdate" class="text-warning">Cargando...</span> In this association, we welcome
                    members from all around the world to collaborate together, work

            </div> on research projects, and engage in various activities, regardless

            <div class="col-md-4"> of your educational background. <em>At CPrA, you will be valued by everyone for your
                    skills and

                    <strong>Estado:</strong><br> abilities, not your degrees. Here, we all work together as a team for
                    the sake of

                    <span id="updateStatus" class="loading">Inicializando...</span> research.</em>

            </div>
            </p>

        </div> <button class="btn btn-secondary">

    </div> <a
        href="https://docs.google.com/forms/d/e/1FAIpQLSdihIGBGy9yiweFVNLHlfKLk6WwK1vkJT8Ejz2b5cmpdPNM2A/viewform?usp=dialog"
        style="color: white; text-decoration: none; border-bottom: none;">Click here to join

        <!-- Controls --> CPrA</a>

    <div class="header-controls text-center"> </button>

        <button class="btn btn-primary btn-custom" onclick="forceUpdate()">Actualizar Ahora</button>
    </div>

    <button class="btn btn-secondary btn-custom" onclick="toggleAutoUpdate()"> <!-- Map Column (Right) -->

        <span id="autoUpdateText">Pausar Auto-actualización</span>
        <div class="col-md-6 d-flex align-items-center justify-content-center">

    </button>
    <div id="map-container" style="width: 100%; max-width: 600px; margin: auto;"></div>

    <button class="btn btn-info btn-custom" onclick="clearCache()">Limpiar Caché</button> </div>

    </div>
    </div>

    </div>

    <!-- Ranking Table --> </section>

    <div class="table-responsive">

        <table class="table table-bordered table-hover">
            <section id="actividades" style="background-color: #F1F1F1">

                <thead class="thead-dark" id="tableHeader">
                    <div class="container">

                        <tr> <br>

                            <th>Posición</th>
                            <h2>Top Activities</h2>

                            <th>Usuario</th>
                            <div class="row">

                                <!-- Problem columns will be added dynamically -->
                                <div class="col-md-6">

                                    <th># AC</th>
                                    <p>We currently have the following activities active:</p>

                                    <th>Tiempo Total</th>
                                    <h6>STEM Research</h6>

                        </tr>
                        <ul>

                </thead>
                <li><em>[<a href="https://docs.google.com/forms/d/e/1FAIpQLSfgrEpjrPj-Odl0ZKnvg5wqh9Mnj2s1wlg-CAkFAygBOIQQkQ/viewform?usp=dialog"
                            <tbody id="rankingTable"> style="color: grey;">Registration period until June 20</a>]</em>
                    CPrA Research

                    <tr> Projects
                </li>

                <td colspan="100%" class="text-center">
                    <li><a href="" style="color: grey;">CPrA STEM-Talks</a>: We invite pioneering companies and

                        <div class="spinner-border text-primary" role="status"> researchers in their fields (e.g.
                            Pasqal, quantum computing) to share insights about their

                            <span class="sr-only">Cargando...</span> work with us.
                    </li>

    </div>
    </ul>

    <br>Cargando datos del ranking... <h6>Competitive Programming</h6>

    </td>
    <ul>

        </tr>
        <li>International competitive programming league co-founded by CPrA: <a </tbody>
                href="https://uam-cpra.github.io/std-ULeague.github.io/"

                </table> style="color: grey;"><i>std::ULeague</i></a></li>

        </div>
        <li><em>[UAM Exclusive]</em> International competitive programming contest: <i><a </div>
                    href="https://swerc.eu/" style="color: grey;">SWERC</a>, <a href="https://icpc.global/"
                    style="color: grey;">ICPC</a></i></li>

        <!-- Scripts -->
        <li><em>[UAM Exclusive]</em> National competitive programming contest: <a <script
                src="https://code.jquery.com/jquery-3.5.1.min.js"></script> href="https://ada-byron.es/" style="color:
                grey;"><i>AdaByron</i></a></li>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    </ul>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    </div>

    <div class="col-md-6">

        <script>                    <div class="row">

        // ====================== VARIABLES GLOBALES ======================                        <div class="col-md-4">

                    let contestConfig = null;                            <img src="img/icpc.png" class="img-fluid" alt="Description of Image 1" style="height: 200px;">

                        let users = [];                        </div>

                let problems = [];                        <div class="col-md-4">

                    let updateInterval = null;                            <img src="img/adabyron.png" class="img-fluid" alt="Description of Image 2"

                        let autoUpdateEnabled= true;                                style="height: 200px;">

                    let lastUpdateTime = null;                        </div>

                let nextUpdateTime = null;                        <div class="col-md-4">

                    <img src="img/eps.jpg" class="img-fluid" alt="Description of Image 3" style="height: 200px;">

        // ====================== FUNCIONES DE UTILIDAD ======================                        </div>

            </div>

            function formatTime(seconds) {                </div >

            const hours = Math.floor(seconds / 3600);            </div >

            const minutes = Math.floor((seconds % 3600) / 60);        </div >

            const remainingSeconds = seconds % 60; <br>

                    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;    </section>

            }



            function formatDateTime(date) {
                <section id="achievements" style="background-color: #F1F1F1">

                return date.toLocaleString('es-ES', {<div class="container" style="background-color: #FaFaFa; border-radius: 20px;">

                    day: '2-digit',            <br>

                        month: '2-digit',             <h2 style="color: #333; text-align: center; font-size: 28px; font-weight: bold;">Achievements</h2>

                        year: 'numeric',            <ul style="list-style-type: none; padding-left: 0;">

                            hour: '2-digit',                <li>

                                minute: '2-digit',                    <button class="btn btn-link achievement-toggle" type="button" data-bs-toggle="collapse"

                                    second: '2-digit'                        data-bs-target="#achievements2025" aria-expanded="false" aria-controls="achievements2025"

            });                        style="color: #333; font-size: 18px; font-weight: bold; text-decoration: none;">

        }                        &rarrc; 2025

                            </button>

                            function updateStatusDisplay() {<div class="collapse" id="achievements2025">

                                const now = new Date();                        <ul style="list-style-type: circle; margin-left: 20px;">

                                    <li style="color: #333; font-size: 16px; font-weight: bold;">Research Projects:</li>

                                    if (lastUpdateTime) {<ul style="list-style-type: square; margin-left: 20px;">

                                        document.getElementById('lastUpdate').textContent = formatDateTime(lastUpdateTime);                                <li style="color: #333; font-size: 14px;">First edition of CPrA research projects

            }                                    successfully launched</li>

                                    </ul>

            if (nextUpdateTime) {<li style="color: #333; font-size: 16px; font-weight: bold;">STEM-Talks #1:</li>

                document.getElementById('nextUpdate').textContent = formatDateTime(nextUpdateTime);                            <ul style="list-style-type: square; margin-left: 20px;">

                                        const timeToNext = Math.max(0, Math.floor((nextUpdateTime - now) / 1000));                                <li style="color: #333; font-size: 14px;">STEM-Talks session held with Pasqal about

                                            quantum computing</li>

                if (timeToNext > 0) {                            </ul>

                                    document.getElementById('updateStatus').innerHTML =                             <li style="color: #333; font-size: 16px; font-weight: bold;">AdaByron Madrid Regional:</li>

                                    `<span class="text-success">Próxima en ${timeToNext}s</span>`;                            <ul style="list-style-type: square; margin-left: 20px;">

                } else {<li style="color: #333; font-size: 14px;">The UAM-CPrA team, Los Churreros: 3rd place

                                            document.getElementById('updateStatus').innerHTML =                                     overall and 2nd in their category. Qualified for the national contest</li>

                        `<span class="text-warning">Actualizando...</span>`;                            </ul>

                }                        </ul>

            }                    </div>

                            }                </li>

                        <li>

        // ====================== FUNCIONES DE DATOS ======================                    <button class="btn btn-link achievement-toggle" type="button" data-bs-toggle="collapse"

                                data-bs-target="#achievements2024" aria-expanded="false" aria-controls="achievements2024"

                                function getLog() {style = "color: #333; font-size: 18px; font-weight: bold; text-decoration: none;" >

            return JSON.parse(localStorage.getItem('submissionLog')) || [];                        &rarrc; 2024

        }                    </button>

                        <div class="collapse" id="achievements2024">

                            function saveLog(logData) {<ul style="list-style-type: circle; margin-left: 20px;">

                                localStorage.setItem('submissionLog', JSON.stringify(logData));                            <li style="color: #333; font-size: 16px; font-weight: bold;">SWERC '24:</li>

        }                            <ul style="list-style-type: square; margin-left: 20px;">

                                    <li style="color: #333; font-size: 14px;">The Fan Team and Los Churreros qualified to

                                        function clearCache() {compete at SWERC (Lisbon), with all expenses paid (November 30 - December 1)</li>

                                    localStorage.removeItem('submissionLog');                            </ul>

                                document.getElementById('updateStatus').innerHTML =                             <li style="color: #333; font-size: 16px; font-weight: bold;">AdaByron National:</li>

                                '<span class="text-info">Caché limpiado</span>';                            <ul style="list-style-type: square; margin-left: 20px;">

            setTimeout(() => forceUpdate(), 1000);                                <li style="color: #333; font-size: 14px;">The UAM-CPrA team, The Fan Team (Marcos

        }                                    Rodríguez, Miguel Carballo, Jesús Alonso), TOP 15 in the National contest</li>

                                </ul>

        // ====================== FUNCIONES DE CARGA ======================                            <li style="color: #333; font-size: 16px; font-weight: bold;">AdaByron Madrid Regional:</li>

                                <ul style="list-style-type: square; margin-left: 20px;">

                                    async function loadConfig() {<li style="color: #333; font-size: 14px;">2 out of the 3 UAM teams in the TOP 10 are

                                        try {from UAM-CPrA, and qualified for the national contest</li>

                const response = await fetch('contest_config.json');                                <li style="color: #333; font-size: 14px;">The UAM-CPrA team, Los Churreros (Marcos

                                        contestConfig = await response.json();                                    López, Marcos Hernanz, Enrique Anguiano Vara): 3rd place overall and 1st in their

                                        category (first-year students)</li>

                                    problems = contestConfig.problems;                            </ul>

                                document.getElementById('contestName').textContent = contestConfig.contest.name;                        </ul>

                                    </div>

                // Crear headers dinámicos                </li>

                    const headerRow = document.querySelector('#tableHeader tr');            </ul>

                // Limpiar headers existentes de problemas            <br>

                const problemHeaders = headerRow.querySelectorAll('.problem-header');        </div>

                problemHeaders.forEach(header => header.remove());        <br>

            </section>

                // Insertar nuevos headers antes de las columnas finales

                const insertBeforeElement = headerRow.children[headerRow.children.length - 2]; // Antes de "# AC"

                <section id="unete" class="bg-light">

                problems.forEach(problem => {        <div class="container">

                    const th = document.createElement('th');            <br>

                    th.className = 'problem-header';            <h2>Contact info</h2>

                    th.textContent = problem.letter;            <div class="row">

                    th.title = `${problem.name} (${problem.contest_id}${problem.problem_index})`;                <div class="col-md-4">

                    headerRow.insertBefore(th, insertBeforeElement);                    <div class="card">

                });                        <div class="card-body">

                                            <h5 class="card-title">Email</h5>

                return true;                            <p class="card-text">cpra.asociacion@uam.es</p>

            } catch (error) {                            <p></p>

                console.error('Error loading config:', error);                        </div>

                document.getElementById('contestName').textContent = 'Error cargando configuración';                    </div>

                return false;                </div>

            }            </div>

        }        </div>

        <br>

        async function loadUsers() {    </section>

            try {

                const response = await fetch('users.json');

                    users = await response.json();    <script>

                        return true;        fetch('jsonData/carousel.json')

            } catch (error) {        .then(response => response.json())

                console.error('Error loading users:', error);        .then(data => {

                            users = [            const carouselInner = document.getElementById('carousel-inner');

                        {username: 'J1', codeforces_handle: 'J1', display_name: 'J1' },            data.forEach((item, idx) => {

                            { username: 'J2', codeforces_handle: 'J2', display_name: 'J2' },            const div = document.createElement('div');

                        {username: 'J3', codeforces_handle: 'J3', display_name: 'J3' },            div.className = 'carousel-item' + (idx === 0 ? ' active' : '');

                        {username: 'J4', codeforces_handle: 'J4', display_name: 'J4' },            div.innerHTML = `

                        {username: 'J5', codeforces_handle: 'J5', display_name: 'J5' }                <a href="${item.href}">

                            ];                <div style="background-color: rgb(241, 226, 175); display: flex; justify-content: center; align-items: center; height: 100%;">

                                return false;                    <img src="img/${item.img}" class="d-block w-100" alt="${item.alt}">

            }                </div>

        }                <div class="carousel-caption d-none d-md-block text-dark" style="background-color: rgba(255,255,255,0.7);">

                                <h5>${item.caption}</h5>

        // ====================== FUNCIONES DE CODEFORCES ======================                </div>

                        </a>

                        async function fetchUserSubmissions(handle) {`;

            try {            carouselInner.appendChild(div);

                document.getElementById('updateStatus').innerHTML =             });

                    `< span class="text-info">Obteniendo datos de ${handle}...</span>`;        });

        </script>

        const response = await fetch(`https://codeforces.com/api/user.status?handle=${handle}&from=1&count=1000`);

        const data = await response.json();
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>



        if (data.status === 'OK') { <!-- Example: World Map using SVG and D3.js (vanilla JS, not React) -->

        return data.result || [];
        <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>

        } else {
        <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>

        console.error(`Error fetching submissions for ${handle}:`, data.comment);
        <script src="https://cdn.jsdelivr.net/npm/topojson-client@3.1.0/dist/topojson-client.min.js"></script>

        return []; <style>
            }

            .country {}

            catch (error) {
                transition: fill 0.2s;

                console.error(`Error fetching submissions for $ {
                        handle
                    }

                    :`, error);
            }

            return [];

            }

            .country:hover {}

            stroke: #222;

            stroke-width: 2;

            async function fetchAllSubmissions() {
                fill: #f7b731 !important;

                const allSubmissions=[];
                cursor: pointer;

            }

            for (const user of users) {

                const userSubmissions=await fetchUserSubmissions(user.codeforces_handle);

                .tooltip {

                    allSubmissions.push(...userSubmissions);
                    position: absolute;

                    background: #fff;

                    // Pequeña pausa entre requests para no sobrecargar la API            border: 1px solid #333;

                    await new Promise(resolve=> setTimeout(resolve, 200));
                    padding: 4px 8px;

                }

                border-radius: 4px;

                pointer-events: none;

                return allSubmissions;
                font-size: 14px;

            }

            color: #222;

            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);

            // ====================== FUNCIÓN PRINCIPAL DE ACTUALIZACIÓN ======================            z-index: 10;

            }

            async function displaySubmissions() {
        </style>

        if (!contestConfig || !problems.length || !users.length) {
        <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>

        console.error('Configuration not loaded properly');
        <script src="https://cdn.jsdelivr.net/npm/topojson-client@3.1.0/dist/topojson-client.min.js"></script>

        return;
        <script>

            }        Promise.all([

            fetch("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(r => r.json()),

            document.getElementById('updateStatus').innerHTML =             fetch("jsonData/paises_valores.json").then(r => r.json())

                        '<span class="text-warning">Actualizando datos...</span>';        ]).then(([worldData, valuesData]) => {

            const width = 600, height = 350;

                        try {            const svg = d3.select("#map-container")

                        const submissions = await fetchAllSubmissions();                .append("svg")

                        const logData = getLog();                .attr("width", width)

                        const contestStartTime = new Date(contestConfig.contest.start_time).getTime() / 1000;                .attr("height", height)

                        .style("background", "none"); // Fondo transparente

                // Procesar submissions

                users.forEach(user => {            const projection = d3.geoMercator()

                    problems.forEach(problem => {                .scale(100)

                        const userSubmissions = submissions.filter(submission =>                 .translate([width / 2, height / 1.5]);

                        submission.contestId === problem.contest_id &&

                        submission.problem.index === problem.problem_index &&            const path = d3.geoPath().projection(projection);

                            submission.author.members.some(member => member.handle === user.codeforces_handle) &&

                            submission.creationTimeSeconds >= contestStartTime            const countries = topojson.feature(worldData, worldData.objects.countries).features;

                        );

                                    // Tooltip

                        userSubmissions.forEach(submission => {            const tooltip = d3.select("body")

                            const existingEntry = logData.find(entry =>                 .append("div")

                        entry.username === user.username &&                .attr("class", "tooltip")

                        entry.problem === `${problem.contest_id}${problem.problem_index}` &&                .style("opacity", 0);

                        entry.submissionId === submission.id

                            );            const maxValue = d3.max(Object.values(valuesData).map(d => Math.log(d)));

                                        const minValue = d3.min(Object.values(valuesData).filter(d => d > 0)); // evitar log(0)

                        if (!existingEntry) {

                            logData.push({

                                username: user.username, const color = d3.scaleLog()

                                    problem: `${problem.contest_id}${problem.problem_index}`,                .domain([minValue, maxValue])

                                    verdict: submission.verdict,                .range(["#b3c6e0", "#08306b"])

                                    time: submission.creationTimeSeconds, const g = svg.append("g");

                                submissionId: submission.id,

                                problemName: problem.name            g.selectAll("path")

                            });                .data(countries)

                            }                .enter().append("path")

                        });                .attr("d", path)

                    });                .attr("class", "country")

                });                .attr("fill", d => valuesData[d.properties.name] ? color(valuesData[d.properties.name]) : "#f5f5f5") // gris suave

                        .attr("stroke", "#bbb")

                // Calcular ranking                .on("mouseover", function (event, d) {

                const ranking = users.map(user => {d3.select(this).raise().attr("fill", "#f7b731");

                        const userStats = {tooltip.transition().duration(200).style("opacity", .95);

                        username: user.username,                    tooltip.html((d.properties.name || "País") + (valuesData[d.properties.name] ? ": " + valuesData[d.properties.name] : ""))

                        displayName: user.display_name,                        .style("left", (event.pageX + 10) + "px")

                        problems: { },                        .style("top", (event.pageY - 20) + "px");

                        totalAC: 0,                })

                        totalTime: 0                .on("mousemove", function (event) {

                        };                    tooltip.style("left", (event.pageX + 10) + "px")

                        .style("top", (event.pageY - 20) + "px");

                    problems.forEach(problem => { })

                        const problemKey = `${problem.contest_id}${problem.problem_index}`;                .on("mouseout", function (event, d) {

                        const problemSubmissions = logData.filter(entry =>                     d3.select(this).attr("fill", valuesData[d.properties.name] ? color(valuesData[d.properties.name]) : "#f5f5f5");

                            entry.username === user.username &&                     tooltip.transition().duration(200).style("opacity", 0);

                            entry.problem === problemKey                });

                        ).sort((a, b) => a.time - b.time);        });

        </script>

        let attempts = 0;

        let solved = false;
        <script>

                        let solveTime = 0;        document.addEventListener("DOMContentLoaded", function () {

                            // Ajusta este valor al alto de tu navbar

                            problemSubmissions.forEach(submission => {
                                var offset = 70; // Altura de la navbar

                                attempts++;

                                if (submission.verdict === 'OK' && !solved) {
                                    document.querySelectorAll('.nav-link').forEach(link => {

                                        solved = true; link.addEventListener('click', function (e) {

                                            solveTime = submission.time - contestStartTime; e.preventDefault();

                                            userStats.totalAC++; var targetId = this.getAttribute('href');

                                            userStats.totalTime += solveTime; var targetPosition = document.querySelector(targetId).offsetTop;

                                        }                    window.scrollTo({

                                        }); top: targetPosition - offset, // Ajusta para no tapar el contenido

                                            behavior: 'smooth'

                        userStats.problems[problemKey] = { });

                            attempts,                });

                            solved,            });

                            solveTime        });

                        };    </script>

        });
</body>



return userStats;<nav>

    }); <footer class="bg-light text-center text-lg-start">

        <div class="text-center p-1" style="background-color: #F1F1F1;">

            // Ordenar ranking <p>© 2024 UAM-CPrA. Webpage made by Enrique Anguiano Vara (President and founder)</p>

            ranking.sort((a, b) => { </div>

        if (a.totalAC !== b.totalAC) return b.totalAC - a.totalAC;
    </footer>

    return a.totalTime - b.totalTime;</nav>

});

</html>
// Mostrar ranking
displayRanking(ranking);
saveLog(logData);

// Actualizar tiempos
lastUpdateTime = new Date();
nextUpdateTime = new Date(lastUpdateTime.getTime() + (contestConfig.contest.auto_update_interval * 1000));

document.getElementById('updateStatus').innerHTML =
'<span class="text-success">Actualización completada</span>';

} catch (error) {
console.error('Error updating submissions:', error);
document.getElementById('updateStatus').innerHTML =
'<span class="text-danger">Error en la actualización</span>';
}
}

function displayRanking(ranking) {
const rankingTable = document.getElementById('rankingTable');
rankingTable.innerHTML = '';

ranking.forEach((user, index) => {
const row = document.createElement('tr');

// Posición
const positionCell = document.createElement('td');
positionCell.innerHTML = `<strong>${index + 1}</strong>`;
row.appendChild(positionCell);

// Usuario
const userCell = document.createElement('td');
userCell.innerHTML = `<strong>${user.displayName}</strong>`;
row.appendChild(userCell);

// Problemas
problems.forEach(problem => {
const problemKey = `${problem.contest_id}${problem.problem_index}`;
const problemData = user.problems[problemKey];
const cell = document.createElement('td');

if (problemData.attempts > 0) {
if (problemData.solved) {
cell.classList.add('green');
cell.innerHTML = `<strong>+${problemData.attempts > 1 ? problemData.attempts - 1 :
    ''}</strong><br><small>${formatTime(problemData.solveTime)}</small>`;
} else {
cell.classList.add('red');
cell.innerHTML = `<strong>-${problemData.attempts}</strong>`;
}
} else {
cell.innerHTML = '';
}

row.appendChild(cell);
});

// Total AC
const acCell = document.createElement('td');
acCell.innerHTML = `<strong>${user.totalAC}</strong>`;
row.appendChild(acCell);

// Tiempo total
const timeCell = document.createElement('td');
timeCell.innerHTML = `<strong>${formatTime(user.totalTime)}</strong>`;
row.appendChild(timeCell);

rankingTable.appendChild(row);
});
}

// ====================== FUNCIONES DE CONTROL ======================

function toggleAutoUpdate() {
autoUpdateEnabled = !autoUpdateEnabled;
const button = document.getElementById('autoUpdateText');

if (autoUpdateEnabled) {
button.textContent = 'Pausar Auto-actualización';
startAutoUpdate();
} else {
button.textContent = 'Reanudar Auto-actualización';
stopAutoUpdate();
}
}

function startAutoUpdate() {
if (updateInterval) clearInterval(updateInterval);

updateInterval = setInterval(() => {
if (autoUpdateEnabled) {
displaySubmissions();
}
}, (contestConfig?.contest.auto_update_interval || 60) * 1000);
}

function stopAutoUpdate() {
if (updateInterval) {
clearInterval(updateInterval);
updateInterval = null;
}
}

function forceUpdate() {
displaySubmissions();
}

// ====================== INICIALIZACIÓN ======================

async function initialize() {
console.log('Iniciando aplicación...');

const configLoaded = await loadConfig();
const usersLoaded = await loadUsers();

if (configLoaded && usersLoaded) {
await displaySubmissions();
startAutoUpdate();

// Actualizar display cada segundo
setInterval(updateStatusDisplay, 1000);
} else {
document.getElementById('updateStatus').innerHTML =
'<span class="text-danger">Error cargando configuración</span>';
}
}

// Iniciar cuando la página esté lista
document.addEventListener('DOMContentLoaded', initialize);

// Actualizar display inicial
updateStatusDisplay();
</script>
</body>

</html>
